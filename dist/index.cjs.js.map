{"version":3,"file":"index.cjs.js","sources":["../src/utils/removeVideoElement.tsx","../src/modules/WRTC-Stream.ts"],"sourcesContent":["export const removeVideoElement = ({ id }: { id: string | undefined }) => {\n  const videoEl = document.getElementById(`vid_${id}`);\n  videoEl?.remove();\n};\n","// import { Socket } from 'socket.io-client';\nimport { IceConfig } from \"../config/iceConfig\";\nimport { IPeers, IStreams, ILogs } from \"../types/EventsManager.types\";\nimport EventEmitter from \"eventemitter3\";\nimport { removeVideoElement } from \"../utils/removeVideoElement\";\nimport { Socket } from \"socket.io-client\";\n\nclass StreamService extends EventEmitter {\n  private peers: IPeers = {};\n  private streams: IStreams;\n  private _localStream: MediaStream | undefined;\n  private _myId: string | undefined;\n  private _isAdmin: boolean | undefined;\n  log: ILogs[\"log\"];\n  warn: ILogs[\"warn\"];\n  error: ILogs[\"error\"];\n  user: { name?: string };\n  room: string | undefined;\n  socket: Socket;\n  pcConfig: IceConfig;\n  connectReady: boolean;\n  isOriginator: boolean;\n  inCall: boolean;\n\n  constructor({\n    socket,\n    pcConfig,\n    logging = { log: true, warn: true, error: true },\n  }: {\n    socket: any;\n    pcConfig: IceConfig;\n    logging: { log?: boolean; warn?: boolean; error?: boolean };\n  }) {\n    super();\n    this.log = logging.log ? console.log : () => {};\n    this.warn = logging.warn ? console.warn : () => {};\n    this.error = logging.error ? console.error : () => {};\n    this.socket = socket;\n    this.pcConfig = pcConfig as IceConfig;\n    this.streams = {};\n    this.user = {};\n    this.isOriginator = false;\n    this.connectReady = false;\n    this.inCall = false;\n  }\n\n  // get stream ready\n  async getMyStream({ name, gridId }: { name: string; gridId: string }) {\n    const videoGrid = document.getElementById(gridId);\n\n    if (!name) {\n      throw new Error(`Video name in stream options is required.`);\n    }\n\n    if (!gridId) {\n      throw new Error(`Video gridId in stream options is required.`);\n    }\n\n    if (!videoGrid) {\n      throw new Error(`Element with id '${gridId}' is required.`);\n    }\n\n    return navigator.mediaDevices\n      .getUserMedia({ audio: false, video: true })\n      .then((stream) => {\n        this.log(\"Media stream ready.\");\n        this.user.name = name;\n        return (this._localStream = stream);\n      });\n  }\n\n  // initialize listeners\n  startListeners() {\n    this._establishSocketListeners();\n  }\n\n  // establish socket listeners\n  private _establishSocketListeners() {\n    // initial connect\n    // if (!this.socket.connected)\n    this.socket.disconnect();\n    this.socket.connect();\n    // listen for connection confirmation\n    this.socket.on(\"connect\", this._socketEvents.connect.bind(this));\n    // logger event\n    this.socket.on(\"log\", this._socketEvents.log.bind(this));\n    // created room event\n    this.socket.on(\"created\", this._socketEvents.created.bind(this));\n    // joined room event\n    this.socket.on(\"joined\", this._socketEvents.joined.bind(this));\n    // join room event\n    this.socket.on(\"join\", this._socketEvents.join.bind(this));\n    // signal message event\n    this.socket.on(\"message\", this._socketEvents.message.bind(this));\n    // room ready event\n    this.socket.on(\"ready\", this._socketEvents.ready.bind(this));\n    // stream ready event\n    this.socket.on(\"stream\", this._socketEvents.stream.bind(this));\n  }\n\n  // socket listener events\n  private _socketEvents = {\n    log: (event: [message?: any, ...optionalParams: any[]]) => {\n      this.log.apply(console, event);\n    },\n    connect: () => {\n      this.log(\"RTC sockets ready.\");\n      return this;\n    },\n    created: (event: { id: string | undefined; room: string | undefined }) => {\n      this._myId = event.id;\n      this.room = event.room;\n      this.isOriginator = true;\n      this._isAdmin = true;\n\n      this.log(\"Created room:\", { event });\n      this.emit(\"created\", event);\n    },\n    joined: (event: {\n      id: string | undefined;\n      room: string | undefined;\n      user: any;\n    }) => {\n      this._myId = event.id;\n      this.room = event.room;\n      this.connectReady = true;\n      this.log(\"Joined room:\", { event });\n      this.emit(\"joined\", event);\n    },\n    join: () => {\n      this.connectReady = true;\n\n      this.emit(\"newJoin\", { newJoin: true });\n    },\n    message: (event: {\n      id: any;\n      type: string;\n      sdp: RTCSessionDescriptionInit;\n      candidate: RTCIceCandidateInit | undefined;\n    }) => {\n      const socketId = event.id;\n\n      if (event.type === \"left\") {\n        this.log(socketId, \"has left the call.\", { event });\n\n        this._removePeer(socketId);\n        this.isOriginator = true;\n\n        this.emit(\"userLeave\", { id: socketId });\n        return;\n      }\n\n      // prevent duplicate connection attempts\n      if (\n        this.peers[socketId] &&\n        this.peers[socketId].connectionState === \"connected\"\n      ) {\n        this.log(\"Connection with\", socketId, \"is already established\", {\n          peersEstablished: this.peers,\n        });\n        return;\n      }\n\n      switch (event.type) {\n        case \"stream-ready\":\n          this._connectPeer(socketId);\n          this.log(\n            \"Client -> Incoming stream, creating peer, adding stream, and making offer:\",\n            {\n              myId: this._myId,\n              theirId: socketId,\n              streams: this.streams,\n              connections: this.peers,\n            }\n          );\n          return;\n        case \"offer\":\n          if (!this.peers[socketId]) {\n            this._connectPeer(socketId);\n          }\n          this.peers[socketId].setRemoteDescription(\n            new RTCSessionDescription(event.sdp)\n          );\n          this._rtcEvents.makeAnswer(socketId);\n          return;\n        case \"answer\":\n          this.peers[socketId].setRemoteDescription(\n            new RTCSessionDescription(event.sdp)\n          );\n          return;\n        case \"candidate\":\n          if (!event?.candidate) {\n            return this.error(\"Client is missing event candidate.\");\n          }\n          this.inCall = true;\n          const candidate = new RTCIceCandidate(event.candidate);\n          this.peers[socketId].addIceCandidate(candidate);\n          return;\n        default:\n          return;\n      }\n    },\n    ready: (event: { id: string | undefined }) => {\n      if (event.id !== this._myId) this.isOriginator = true;\n    },\n    stream() {\n      console.log(\"TODO socket stream event!\");\n    },\n  };\n\n  private _rtcEvents = {\n    makeOffer: (socketId: string) => {\n      this.log(\"Making offer:\", { peer: this.peers[socketId] });\n\n      this.peers[socketId]\n        .createOffer()\n        .then(\n          this._rtcEvents.sendLocalDescription.bind(this, socketId),\n          this._rtcEvents.createOfferError\n        );\n    },\n    makeAnswer: (socketId: string) => {\n      this.log(\"Sending answer:\", { peer: this.peers[socketId] });\n\n      this.peers[socketId]\n        .createAnswer()\n        .then(\n          this._rtcEvents.sendLocalDescription.bind(this, socketId),\n          this._rtcEvents.sdpError\n        );\n    },\n    sendLocalDescription: async (socketId: string, sessionDescription: any) => {\n      try {\n        await this.peers[socketId].setLocalDescription(sessionDescription);\n        this._sendMessage({\n          toId: socketId,\n          name: this.user.name,\n          room: this.room,\n          sdp: sessionDescription,\n          type: sessionDescription.type,\n        });\n      } catch (e) {\n        if (this.peers[socketId].connectionState !== \"new\") {\n          this.error(\"Failed to setLocalDescription\", {\n            state: this.peers[socketId].connectionState,\n            peer: this.peers[socketId],\n            peers: this.peers,\n          });\n        }\n      }\n    },\n    addTrack: (socketId: string, event: { streams: MediaStream[] }) => {\n      this.log(\"Remote stream added for \", this.peers[socketId]);\n\n      if (this.streams[socketId]?.id !== event.streams[0].id) {\n        this.streams[socketId] = event.streams[0];\n\n        this.emit(\"stream\", {\n          id: socketId,\n          stream: event.streams[0],\n        });\n        this.socket.emit(\"stream\", {\n          id: socketId,\n          stream: event.streams[0],\n        });\n      }\n    },\n    removeTrack: (socketId: string, event: { streams: MediaStream[] }) => {\n      this.isOriginator = false;\n      this._removePeer(socketId);\n\n      this.emit(\"left\", {\n        id: socketId,\n        stream: event.streams[0],\n      });\n    },\n    iceCandidate: (socketId: string, event: RTCIceCandidate) => {\n      if (event.candidate) {\n        this._sendMessage({\n          toId: socketId,\n          name: this.user.name,\n          room: this.room,\n          candidate: event.candidate,\n          type: \"candidate\",\n        });\n      }\n    },\n    stateChange: (socketId: string, event: RTCSignalingState) => {\n      const connectionState: RTCPeerConnectionState =\n        this.peers[socketId].connectionState;\n      this.log(\"RTC state change:\", connectionState);\n      if (connectionState === \"disconnected\" || connectionState === \"failed\") {\n        this.emit(\"left\", {\n          id: socketId,\n        });\n      }\n    },\n    sdpError: (error: RTCError) => {\n      this.log(\"Session description error: \" + error.toString());\n\n      this.emit(\"error\", {\n        error: new Error(`Session description error: ${error.toString()}`),\n      });\n    },\n    createOfferError: () => {\n      this.error(\"ERROR creating offer\");\n\n      this.emit(\"error\", {\n        error: new Error(\"Error while creating an offer\"),\n      });\n    },\n  };\n\n  private async _createPeer(socketId: string) {\n    try {\n      if (this.peers[socketId]) {\n        // do not create peer if connection is already established\n        this.warn(\"You're already connected with:\", socketId);\n        return;\n      }\n\n      this.peers[socketId] = new RTCPeerConnection(\n        this.pcConfig as RTCConfiguration\n      );\n      this.peers[socketId].onicecandidate = this._rtcEvents.iceCandidate.bind(\n        this,\n        socketId\n      );\n      this.peers[socketId].ontrack = this._rtcEvents.addTrack.bind(\n        this,\n        socketId\n      );\n      this.peers[socketId].onremovetrack = this._rtcEvents.removeTrack.bind(\n        this,\n        socketId\n      );\n      this.peers[socketId].onconnectionstatechange =\n        this._rtcEvents.stateChange.bind(this, socketId);\n\n      this.log(\"Created RTC Peer for:\", { socketId, peers: this.peers });\n    } catch (error: any) {\n      this.error(\"RTC Peer failed: \" + error.message);\n\n      this.emit(\"error\", {\n        error: new Error(`RTC Peer failed: ${error.message}`),\n      });\n    }\n  }\n\n  // connect rtc peer connection\n  private _connectPeer(socketId: string) {\n    if (this._localStream === undefined && !this.connectReady) {\n      return this.warn(\"This remote peer is not ready for connection.\", {\n        ready: this.connectReady,\n        localStream: this._localStream,\n        id: socketId,\n      });\n    }\n\n    this._createPeer(socketId);\n    this.peers[socketId].addStream(this._localStream);\n\n    if (this.isOriginator) {\n      this.log(\"FYI - You initiated this call.\");\n      this.log(\"Creating offer for:\", socketId);\n\n      this._rtcEvents.makeOffer(socketId);\n    } else {\n      this.log(\"FYI - You received this call.\");\n    }\n  }\n\n  private _removePeer(socketId: string) {\n    if (!socketId) {\n      this.peers.forEach((peer: any, index: number) => {\n        this.log(\"Closing peer connection:\", { id: socketId, peer });\n        peer.close();\n        delete this.peers[index];\n      });\n      this.streams = {};\n    } else {\n      if (!this.peers[socketId]) return;\n      this.peers[socketId].close();\n      delete this.peers[socketId];\n      delete this.streams[socketId];\n    }\n\n    this.emit(\"left\", { id: socketId });\n  }\n\n  // server event emitter\n  private _sendMessage(event: any) {\n    setTimeout(() => {\n      this.socket.emit(\"message\", { ...event, id: event.id });\n    }, 0);\n  }\n\n  // public method: join room\n  joinRoom(name: string, room: string) {\n    if (this.room) {\n      return this.warn(\"You are currently in a room.\");\n    }\n\n    if (!room) {\n      return this.error(\"Room name was not provided to join.\");\n    }\n\n    // create room\n    this.user.name = name;\n    this.log(\"create or join\", { name: this.user.name, room });\n    this.socket.emit(\"create or join\", {\n      user: this.user,\n      name: this.user.name,\n      room,\n    });\n  }\n\n  // public method: leave room\n  leaveRoom(room: string) {\n    // leave room\n    this.log(\"leaving room\", { name: this.user.name, room });\n\n    this.isOriginator = false;\n    this._sendMessage({ type: \"left\", user: this.user });\n  }\n\n  // public method: sends message to server\n  // broadcasting stream is ready\n  sendStreamReady() {\n    if (this.room) {\n      this._sendMessage({ type: \"stream-ready\", room: this.room });\n    } else {\n      this.warn(\"You need to join a room before streaming.\");\n    }\n  }\n\n  stopListeners() {\n    this.removeAllListeners();\n    this.socket.removeAllListeners();\n    if (this._myId) {\n      this.peers[this._myId as string]?.close();\n      this._localStream?.getTracks().forEach((track) => track.stop());\n      removeVideoElement({ id: this._myId });\n      this.log(\"Destroyed RTC session.\");\n    }\n  }\n}\n\nexport default StreamService;\n"],"names":["removeVideoElement","id","StreamService","EventEmitter","socket","pcConfig","logging","event","socketId","candidate","sessionDescription","connectionState","error","name","gridId","videoGrid","stream","peer","index","room","track"],"mappings":"8CAAaA,EAAqB,CAAC,CAAE,GAAAC,KAAqC,CACxD,SAAS,eAAe,OAAOA,GAAI,GAC1C,OAAO,CAClB,ECIA,MAAMC,UAAsBC,CAAa,CAiBvC,YAAY,CACV,OAAAC,EACA,SAAAC,EACA,QAAAC,EAAU,CAAE,IAAK,GAAM,KAAM,GAAM,MAAO,EAAK,CAAA,EAK9C,CACK,QAzBR,KAAQ,MAAgB,GA6FxB,KAAQ,cAAgB,CACtB,IAAMC,GAAqD,CACpD,KAAA,IAAI,MAAM,QAASA,CAAK,CAC/B,EACA,QAAS,KACP,KAAK,IAAI,oBAAoB,EACtB,MAET,QAAUA,GAAgE,CACxE,KAAK,MAAQA,EAAM,GACnB,KAAK,KAAOA,EAAM,KAClB,KAAK,aAAe,GACpB,KAAK,SAAW,GAEhB,KAAK,IAAI,gBAAiB,CAAE,MAAAA,CAAO,CAAA,EAC9B,KAAA,KAAK,UAAWA,CAAK,CAC5B,EACA,OAASA,GAIH,CACJ,KAAK,MAAQA,EAAM,GACnB,KAAK,KAAOA,EAAM,KAClB,KAAK,aAAe,GACpB,KAAK,IAAI,eAAgB,CAAE,MAAAA,CAAO,CAAA,EAC7B,KAAA,KAAK,SAAUA,CAAK,CAC3B,EACA,KAAM,IAAM,CACV,KAAK,aAAe,GAEpB,KAAK,KAAK,UAAW,CAAE,QAAS,EAAM,CAAA,CACxC,EACA,QAAUA,GAKJ,CACJ,MAAMC,EAAWD,EAAM,GAEnB,GAAAA,EAAM,OAAS,OAAQ,CACzB,KAAK,IAAIC,EAAU,qBAAsB,CAAE,MAAAD,CAAO,CAAA,EAElD,KAAK,YAAYC,CAAQ,EACzB,KAAK,aAAe,GAEpB,KAAK,KAAK,YAAa,CAAE,GAAIA,CAAU,CAAA,EACvC,OAKA,GAAA,KAAK,MAAMA,CAAQ,GACnB,KAAK,MAAMA,CAAQ,EAAE,kBAAoB,YACzC,CACK,KAAA,IAAI,kBAAmBA,EAAU,yBAA0B,CAC9D,iBAAkB,KAAK,KAAA,CACxB,EACD,OAGF,OAAQD,EAAM,KAAM,CAClB,IAAK,eACH,KAAK,aAAaC,CAAQ,EACrB,KAAA,IACH,6EACA,CACE,KAAM,KAAK,MACX,QAASA,EACT,QAAS,KAAK,QACd,YAAa,KAAK,KACpB,CAAA,EAEF,OACF,IAAK,QACE,KAAK,MAAMA,CAAQ,GACtB,KAAK,aAAaA,CAAQ,EAEvB,KAAA,MAAMA,CAAQ,EAAE,qBACnB,IAAI,sBAAsBD,EAAM,GAAG,CAAA,EAEhC,KAAA,WAAW,WAAWC,CAAQ,EACnC,OACF,IAAK,SACE,KAAA,MAAMA,CAAQ,EAAE,qBACnB,IAAI,sBAAsBD,EAAM,GAAG,CAAA,EAErC,OACF,IAAK,YACC,GAAA,CAACA,GAAO,UACH,OAAA,KAAK,MAAM,oCAAoC,EAExD,KAAK,OAAS,GACd,MAAME,EAAY,IAAI,gBAAgBF,EAAM,SAAS,EACrD,KAAK,MAAMC,CAAQ,EAAE,gBAAgBC,CAAS,EAC9C,OACF,QACE,MACJ,CACF,EACA,MAAQF,GAAsC,CACxCA,EAAM,KAAO,KAAK,QAAO,KAAK,aAAe,GACnD,EACA,QAAS,CACP,QAAQ,IAAI,2BAA2B,CACzC,CAAA,EAGF,KAAQ,WAAa,CACnB,UAAYC,GAAqB,CAC1B,KAAA,IAAI,gBAAiB,CAAE,KAAM,KAAK,MAAMA,CAAQ,EAAG,EAExD,KAAK,MAAMA,CAAQ,EAChB,YACA,EAAA,KACC,KAAK,WAAW,qBAAqB,KAAK,KAAMA,CAAQ,EACxD,KAAK,WAAW,gBAAA,CAEtB,EACA,WAAaA,GAAqB,CAC3B,KAAA,IAAI,kBAAmB,CAAE,KAAM,KAAK,MAAMA,CAAQ,EAAG,EAE1D,KAAK,MAAMA,CAAQ,EAChB,aACA,EAAA,KACC,KAAK,WAAW,qBAAqB,KAAK,KAAMA,CAAQ,EACxD,KAAK,WAAW,QAAA,CAEtB,EACA,qBAAsB,MAAOA,EAAkBE,IAA4B,CACrE,GAAA,CACF,MAAM,KAAK,MAAMF,CAAQ,EAAE,oBAAoBE,CAAkB,EACjE,KAAK,aAAa,CAChB,KAAMF,EACN,KAAM,KAAK,KAAK,KAChB,KAAM,KAAK,KACX,IAAKE,EACL,KAAMA,EAAmB,IAAA,CAC1B,QAEG,KAAK,MAAMF,CAAQ,EAAE,kBAAoB,OAC3C,KAAK,MAAM,gCAAiC,CAC1C,MAAO,KAAK,MAAMA,CAAQ,EAAE,gBAC5B,KAAM,KAAK,MAAMA,CAAQ,EACzB,MAAO,KAAK,KAAA,CACb,CAEL,CACF,EACA,SAAU,CAACA,EAAkBD,IAAsC,CACjE,KAAK,IAAI,2BAA4B,KAAK,MAAMC,CAAQ,CAAC,EAErD,KAAK,QAAQA,CAAQ,GAAG,KAAOD,EAAM,QAAQ,CAAC,EAAE,KAClD,KAAK,QAAQC,CAAQ,EAAID,EAAM,QAAQ,CAAC,EAExC,KAAK,KAAK,SAAU,CAClB,GAAIC,EACJ,OAAQD,EAAM,QAAQ,CAAC,CAAA,CACxB,EACI,KAAA,OAAO,KAAK,SAAU,CACzB,GAAIC,EACJ,OAAQD,EAAM,QAAQ,CAAC,CAAA,CACxB,EAEL,EACA,YAAa,CAACC,EAAkBD,IAAsC,CACpE,KAAK,aAAe,GACpB,KAAK,YAAYC,CAAQ,EAEzB,KAAK,KAAK,OAAQ,CAChB,GAAIA,EACJ,OAAQD,EAAM,QAAQ,CAAC,CAAA,CACxB,CACH,EACA,aAAc,CAACC,EAAkBD,IAA2B,CACtDA,EAAM,WACR,KAAK,aAAa,CAChB,KAAMC,EACN,KAAM,KAAK,KAAK,KAChB,KAAM,KAAK,KACX,UAAWD,EAAM,UACjB,KAAM,WAAA,CACP,CAEL,EACA,YAAa,CAACC,EAAkBD,IAA6B,CAC3D,MAAMI,EACJ,KAAK,MAAMH,CAAQ,EAAE,gBAClB,KAAA,IAAI,oBAAqBG,CAAe,GACzCA,IAAoB,gBAAkBA,IAAoB,WAC5D,KAAK,KAAK,OAAQ,CAChB,GAAIH,CAAA,CACL,CAEL,EACA,SAAWI,GAAoB,CAC7B,KAAK,IAAI,8BAAgCA,EAAM,SAAU,CAAA,EAEzD,KAAK,KAAK,QAAS,CACjB,MAAO,IAAI,MAAM,8BAA8BA,EAAM,SAAY,GAAA,CAAA,CAClE,CACH,EACA,iBAAkB,IAAM,CACtB,KAAK,MAAM,sBAAsB,EAEjC,KAAK,KAAK,QAAS,CACjB,MAAO,IAAI,MAAM,+BAA+B,CAAA,CACjD,CACH,CAAA,EApRA,KAAK,IAAMN,EAAQ,IAAM,QAAQ,IAAM,IAAM,CAAA,EAC7C,KAAK,KAAOA,EAAQ,KAAO,QAAQ,KAAO,IAAM,CAAA,EAChD,KAAK,MAAQA,EAAQ,MAAQ,QAAQ,MAAQ,IAAM,CAAA,EACnD,KAAK,OAASF,EACd,KAAK,SAAWC,EAChB,KAAK,QAAU,GACf,KAAK,KAAO,GACZ,KAAK,aAAe,GACpB,KAAK,aAAe,GACpB,KAAK,OAAS,EAChB,CAGA,MAAM,YAAY,CAAE,KAAAQ,EAAM,OAAAC,GAA4C,CAC9D,MAAAC,EAAY,SAAS,eAAeD,CAAM,EAEhD,GAAI,CAACD,EACG,MAAA,IAAI,MAAM,2CAA2C,EAG7D,GAAI,CAACC,EACG,MAAA,IAAI,MAAM,6CAA6C,EAG/D,GAAI,CAACC,EACG,MAAA,IAAI,MAAM,oBAAoBD,iBAAsB,EAG5D,OAAO,UAAU,aACd,aAAa,CAAE,MAAO,GAAO,MAAO,EAAM,CAAA,EAC1C,KAAME,IACL,KAAK,IAAI,qBAAqB,EAC9B,KAAK,KAAK,KAAOH,EACT,KAAK,aAAeG,EAC7B,CACL,CAGA,gBAAiB,CACf,KAAK,0BAA0B,CACjC,CAGQ,2BAA4B,CAGlC,KAAK,OAAO,aACZ,KAAK,OAAO,UAEP,KAAA,OAAO,GAAG,UAAW,KAAK,cAAc,QAAQ,KAAK,IAAI,CAAC,EAE1D,KAAA,OAAO,GAAG,MAAO,KAAK,cAAc,IAAI,KAAK,IAAI,CAAC,EAElD,KAAA,OAAO,GAAG,UAAW,KAAK,cAAc,QAAQ,KAAK,IAAI,CAAC,EAE1D,KAAA,OAAO,GAAG,SAAU,KAAK,cAAc,OAAO,KAAK,IAAI,CAAC,EAExD,KAAA,OAAO,GAAG,OAAQ,KAAK,cAAc,KAAK,KAAK,IAAI,CAAC,EAEpD,KAAA,OAAO,GAAG,UAAW,KAAK,cAAc,QAAQ,KAAK,IAAI,CAAC,EAE1D,KAAA,OAAO,GAAG,QAAS,KAAK,cAAc,MAAM,KAAK,IAAI,CAAC,EAEtD,KAAA,OAAO,GAAG,SAAU,KAAK,cAAc,OAAO,KAAK,IAAI,CAAC,CAC/D,CAuNA,MAAc,YAAYR,EAAkB,CACtC,GAAA,CACE,GAAA,KAAK,MAAMA,CAAQ,EAAG,CAEnB,KAAA,KAAK,iCAAkCA,CAAQ,EACpD,OAGG,KAAA,MAAMA,CAAQ,EAAI,IAAI,kBACzB,KAAK,QAAA,EAEP,KAAK,MAAMA,CAAQ,EAAE,eAAiB,KAAK,WAAW,aAAa,KACjE,KACAA,CAAA,EAEF,KAAK,MAAMA,CAAQ,EAAE,QAAU,KAAK,WAAW,SAAS,KACtD,KACAA,CAAA,EAEF,KAAK,MAAMA,CAAQ,EAAE,cAAgB,KAAK,WAAW,YAAY,KAC/D,KACAA,CAAA,EAEG,KAAA,MAAMA,CAAQ,EAAE,wBACnB,KAAK,WAAW,YAAY,KAAK,KAAMA,CAAQ,EAEjD,KAAK,IAAI,wBAAyB,CAAE,SAAAA,EAAU,MAAO,KAAK,MAAO,QAC1DI,GACF,KAAA,MAAM,oBAAsBA,EAAM,OAAO,EAE9C,KAAK,KAAK,QAAS,CACjB,MAAO,IAAI,MAAM,oBAAoBA,EAAM,SAAS,CAAA,CACrD,CACH,CACF,CAGQ,aAAaJ,EAAkB,CACrC,GAAI,KAAK,eAAiB,QAAa,CAAC,KAAK,aACpC,OAAA,KAAK,KAAK,gDAAiD,CAChE,MAAO,KAAK,aACZ,YAAa,KAAK,aAClB,GAAIA,CAAA,CACL,EAGH,KAAK,YAAYA,CAAQ,EACzB,KAAK,MAAMA,CAAQ,EAAE,UAAU,KAAK,YAAY,EAE5C,KAAK,cACP,KAAK,IAAI,gCAAgC,EACpC,KAAA,IAAI,sBAAuBA,CAAQ,EAEnC,KAAA,WAAW,UAAUA,CAAQ,GAElC,KAAK,IAAI,+BAA+B,CAE5C,CAEQ,YAAYA,EAAkB,CACpC,GAAI,CAACA,EACH,KAAK,MAAM,QAAQ,CAACS,EAAWC,IAAkB,CAC/C,KAAK,IAAI,2BAA4B,CAAE,GAAIV,EAAU,KAAAS,EAAM,EAC3DA,EAAK,MAAM,EACJ,OAAA,KAAK,MAAMC,CAAK,CAAA,CACxB,EACD,KAAK,QAAU,OACV,CACD,GAAA,CAAC,KAAK,MAAMV,CAAQ,EAAG,OACtB,KAAA,MAAMA,CAAQ,EAAE,MAAM,EACpB,OAAA,KAAK,MAAMA,CAAQ,EACnB,OAAA,KAAK,QAAQA,CAAQ,EAG9B,KAAK,KAAK,OAAQ,CAAE,GAAIA,CAAU,CAAA,CACpC,CAGQ,aAAaD,EAAY,CAC/B,WAAW,IAAM,CACV,KAAA,OAAO,KAAK,UAAW,CAAE,GAAGA,EAAO,GAAIA,EAAM,EAAA,CAAI,GACrD,CAAC,CACN,CAGA,SAASM,EAAcM,EAAc,CACnC,GAAI,KAAK,KACA,OAAA,KAAK,KAAK,8BAA8B,EAGjD,GAAI,CAACA,EACI,OAAA,KAAK,MAAM,qCAAqC,EAIzD,KAAK,KAAK,KAAON,EACZ,KAAA,IAAI,iBAAkB,CAAE,KAAM,KAAK,KAAK,KAAM,KAAAM,EAAM,EACpD,KAAA,OAAO,KAAK,iBAAkB,CACjC,KAAM,KAAK,KACX,KAAM,KAAK,KAAK,KAChB,KAAAA,CAAA,CACD,CACH,CAGA,UAAUA,EAAc,CAEjB,KAAA,IAAI,eAAgB,CAAE,KAAM,KAAK,KAAK,KAAM,KAAAA,EAAM,EAEvD,KAAK,aAAe,GACpB,KAAK,aAAa,CAAE,KAAM,OAAQ,KAAM,KAAK,KAAM,CACrD,CAIA,iBAAkB,CACZ,KAAK,KACP,KAAK,aAAa,CAAE,KAAM,eAAgB,KAAM,KAAK,KAAM,EAE3D,KAAK,KAAK,2CAA2C,CAEzD,CAEA,eAAgB,CACd,KAAK,mBAAmB,EACxB,KAAK,OAAO,qBACR,KAAK,QACP,KAAK,MAAM,KAAK,KAAe,GAAG,MAAM,EACnC,KAAA,cAAc,YAAY,QAASC,GAAUA,EAAM,MAAM,EAC9DpB,EAAmB,CAAE,GAAI,KAAK,KAAO,CAAA,EACrC,KAAK,IAAI,wBAAwB,EAErC,CACF"}